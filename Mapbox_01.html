<!DOCTYPE html>
<html>
<head>
  <title>London Attraction Map</title>
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.9.2/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.9.2/mapbox-gl.css" rel="stylesheet">
  
    
<style>
    #title {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: #FFD700;
      font-size: 2em;
      font-family: 'Arial Black', sans-serif;
      text-shadow: 0 0 5px rgba(255,215,0,0.2);
      z-index: 1000;
      padding: 10px 20px;
      border-radius: 15px;
      background: rgba(0,0,0,0);
    }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }

    /* ä¾§è¾¹ç­›é€‰é¢æ¿ */
    .filter-panel {
      position: fixed;
      left: -200px;
      top: 220px;
      width: 180px;
      background: rgba(0,0,0,0.8);
      border-radius: 0 8px 8px 0;
      transition: all 0.3s ease;
      box-shadow: 3px 0 15px rgba(0,0,0,0.3);
      z-index: 1000;
      padding: 10px;
    }

    .filter-panel.expanded {
      left: 0;
    }

    /* åˆ‡æ¢æŒ‰é’® */
    .toggle-button {
      position: absolute;
      right: -30px;
      top: 0;
      width: 30px;
      height: 100%;
      background: rgba(0,0,0,0.7);
      border-radius: 0 8px 8px 0;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #FFD700;
      font-size: 1.5em;
      border: none;
    }

    /* ç­›é€‰é€‰é¡¹ */
    .filter-option {
      padding: 10px;
      color: white;
      cursor: pointer;
      border-radius: 5px;
      display: flex;
      align-items: center;
      transition: all 0.2s;
      margin: 5px 0;
    }

    .filter-option:hover {
      background: rgba(255,215,0,0.1);
    }

    .filter-option.active {
      background: rgba(255,215,0,0.2);
      box-shadow: 0 0 8px rgba(255,215,0,0.3);
    }

    .color-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 10px;
    }
    
    /* è°ƒæ•´æŒ‡å—é’ˆæŒ‰é’®æ ·å¼ */
     .mapboxgl-ctrl-compass {
         background-color: rgba(0,0,0,0.7) !important;
         border-radius: 8px !important;
    }

  </style>
</head>

<body>
  <div id="title">London Attractions Map</div>  

  <!-- æŠ˜å ç­›é€‰é¢æ¿ -->
  <div class="filter-panel">
    <button class="toggle-button">Â»</button>
    <div class="filter-content">
      <div class="filter-option active" data-type="all">
        <div class="color-dot" style="background: #FFFFFF"></div>
        All Types
      </div>
    </div>
  </div>

  <div id="map"></div>

  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoieWwzIiwiYSI6ImNtN2txZGc2czAzYjMybXNka3ZsbTl5cmQifQ.kV4cU6Id_aGZM7R1HiudwA';
    
    // åˆ†ç±»é¢œè‰²é…ç½®
    const categoryColors = {
      museum: '#FF6B6B',
      gallery: '#3498DB',
      attraction: '#FFD700',
      'zoo+aquarium': '#FF9F43',
      park: '#2ECC71',
      historic: '#8B4513'
    };

    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/dark-v11',
      center: [-0.1278, 51.5074],
      zoom: 12
    });
      
    // æ·»åŠ å¯¼èˆªæ§ä»¶ï¼ˆåŒ…å«æŒ‡å—é’ˆ + ç¼©æ”¾æŒ‰é’®ï¼‰
    map.addControl(new mapboxgl.NavigationControl(), 'top-left');
      
    // åˆå§‹åŒ–å¼¹çª—
    const popup = new mapboxgl.Popup({
      closeButton: true,
      offset: [0, -20],
      className: 'custom-popup'
    });

    let currentPopup = null;
    let closeTimer;

    // ä¾§è¾¹æ æ§åˆ¶é€»è¾‘
    const filterPanel = document.querySelector('.filter-panel');
    const toggleButton = document.querySelector('.toggle-button');

    toggleButton.addEventListener('click', (e) => {
      e.stopPropagation();
      filterPanel.classList.toggle('expanded');
      toggleButton.innerHTML = filterPanel.classList.contains('expanded') ? 'Â«' : 'Â»';
    });

    // ç‚¹å‡»å¤–éƒ¨å…³é—­ä¾§è¾¹æ 
    document.addEventListener('click', (e) => {
      if (!filterPanel.contains(e.target) && !toggleButton.contains(e.target)) {
        filterPanel.classList.remove('expanded');
        toggleButton.innerHTML = 'Â»';
      }
    });

    map.on('load', () => {
      
      // æ·»åŠ ä¼¦æ•¦è¾¹ç•Œæ•°æ®
      map.addSource('london-boundary', {
        type: 'geojson',
        data: 'https://raw.githubusercontent.com/YULI61/visual_personal/main/London_boundary.geojson'
      });

      // æ·»åŠ è¾¹ç•Œå›¾å±‚ï¼ˆçº¿å›¾å±‚ï¼‰
      map.addLayer({
        id: 'london-boundary-layer',
        type: 'line',
        source: 'london-boundary',
        paint: {
          'line-color': '#FFFFFF',
          'line-width': 1.5,
          'line-opacity': 0.4
        }
      });
        
      // æ·»åŠ æ™¯ç‚¹æ•°æ®
      map.addSource('attractions', {
        type: 'geojson',
        data: 'https://raw.githubusercontent.com/YULI61/visual_personal/main/london_tourism_2.geojson'
      });

      // æ·»åŠ åˆ†ç±»é¢œè‰²å›¾å±‚
      map.addLayer({
        id: 'attractions-layer',
        type: 'circle',
        source: 'attractions',
        paint: {
          'circle-radius': 8,
          'circle-color': [
            'match', 
            ['get', 'type'],
            'museum', categoryColors.museum,
            'gallery', categoryColors.gallery,
            'zoo+aquarium', categoryColors.'zoo+aquarium',
            'park', categoryColors.park,
            'historic', categoryColors.historic,
            'aquarium', categoryColors.aquarium,
            '#CCCCCC' // é»˜è®¤é¢œè‰²
          ],
          'circle-opacity': 0.8,
          'circle-stroke-width': 0,
          'circle-stroke-color': '#FFFFFF'
        }
      });

      // åŠ¨æ€ç”Ÿæˆç­›é€‰é€‰é¡¹
      const filterContent = document.querySelector('.filter-content');
      Object.entries(categoryColors).forEach(([type, color]) => {
        const option = document.createElement('div');
        option.className = 'filter-option';
        option.dataset.type = type;
        option.innerHTML = `
          <div class="color-dot" style="background: ${color}"></div>
          ${type.charAt(0).toUpperCase() + type.slice(1)}
        `;
        filterContent.appendChild(option);
      });

      // ç­›é€‰åŠŸèƒ½
      document.querySelectorAll('.filter-option').forEach(option => {
        option.addEventListener('click', function() {
          document.querySelectorAll('.filter-option').forEach(opt => opt.classList.remove('active'));
          this.classList.add('active');
          
          const selectedType = this.dataset.type;
          map.setFilter('attractions-layer', 
            selectedType === 'all' ? null : ['==', ['get', 'type'], selectedType]
          );
        });
      });

      // æ‚¬åœæ˜¾ç¤ºå¼¹çª—
      map.on('mouseenter', 'attractions-layer', (e) => {
        if (currentPopup) return;

        const props = e.features[0].properties;
        let html = `<h3 style="margin:0; color:${categoryColors[props.type] || '#FFF'}">${props.name}</h3>`;
        if (props.type) html += `<p style="color:#666">Type: ${props.type}</p>`;
        if (props.image) html += `<img src="${props.image}" style="max-width:200px; margin:10px 0">`;
        if (props.address) html += `<p>ğŸ“ ${props.address}</p>`;
        if (props.website) html += `<p>ğŸŒ <a href="${props.website}" target="_blank" style="color:#1a73e8">Website</a></p>`;
        if (props.wikipedia) {
          const [lang, page] = props.wikipedia.split(':');
          html += `<p>ğŸ“š <a href="https://${lang}.wikipedia.org/wiki/${page.replace(/ /g, '_')}" target="_blank" style="color:#1a73e8">Wikipedia</a></p>`;
        }

        currentPopup = popup.setLngLat(e.lngLat).setHTML(html);
        currentPopup.addTo(map);
      });

      // å¼¹çª—æ§åˆ¶é€»è¾‘
      map.on('mouseleave', 'attractions-layer', () => {
        closeTimer = setTimeout(() => {
          currentPopup?.remove();
          currentPopup = null;
        }, 300);
      });

      document.addEventListener('mouseover', (e) => {
        if (e.target.closest('.mapboxgl-popup-content')) {
          clearTimeout(closeTimer);
        }
      });

          
      // é“è·¯æ ·å¼ä¿®æ”¹
      setTimeout(() => {
          const roadLayers = map.getStyle().layers.filter(layer => layer.id && layer.id.includes('road'));

          roadLayers.forEach(layer => {
              map.setPaintProperty(layer.id, 'line-color', '#FFD700');
              map.setPaintProperty(layer.id, 'line-width', layer.id.includes('primary') || layer.id.includes('secondary') || layer.id.includes('tertiary') ? 2.5 : 1);
              map.setPaintProperty(layer.id, 'line-opacity', layer.id.includes('primary') || layer.id.includes('secondary') || layer.id.includes('tertiary') ? 0.8 : 0.2);
          });
      }, 1000);

    });
  </script>
</body>
</html>